# 四个内存层次的问题

我们继续介绍缓存，回答关于内存层次结构第一层的四个常见问题：

* Q1: 块可以放在上一级的什么地方？(块放置)&#x20;
* Q2: 如果一个块在上一级，如何找到它？(块识别)&#x20;
* Q3: 在未命中的情况下，应该替换哪个块？(块替换)&#x20;
* Q4: 写入时发生什么？(写策略)

对这些问题的回答有助于我们理解层次结构中不同层次内存的不同权衡；因此，我们对每一个例子都要问这四个问题。

Q1:块可以放在上一级的什么地方？

图B.2显示，对块放置位置的限制创造了三种类型的缓存组织：

*   如果每个块在缓存中只有一个地方可以映射，那么缓存就被称为直接映射。这种映射通常是：

    (块地址) MOD (_缓存中块的个数_)，MOD是取模操作。
* 如果一个块可以放在缓存的任何地方，那么这个缓存就可以说是全相联的。
* 如果一个块可以被放置在缓存中的某个区域，那么缓存就是组相联的。一个组是缓存中块的集合。一个块首先被映射到一个集合上，然后该块可以被放置在该集合的任何地方。这个集合通常是通过位选择（bit selection）的，也就是说：(块地址) MOD (组的个数)。

![图B.2 这个例子的缓存有8个块帧（block frames），内存有32个块。 缓存的三个选项从左到右显示。在全相联的情况下，下层块12可以进入缓存的八个块帧中的任何一个。在直接映射的情况下，第12块只能被放入第4个块帧（12的模数为8）。组相联——具有这两种特性的一部分——允许块被放置在组0（12模4）的任何地方。每组有两个块，这意味着块12可以放在缓存的第0块或第1块中。真正的高速缓存包含成千上万的块帧，而真正的存储器包含数百万的块。组相联有四组，每组有两个块，称为双组相联。假设缓存中没有任何东西，有关的块地址标识的是低级块12。](../../.gitbook/assets/NeatReader-1656577525140.png)

如果一个集合中有n个块，那么这个缓存就被称为n路组相联（n-way set associative）。

从直接映射到全相联的缓存范围实际上是一个组相联的连续体。直接映射是简单的单向集合关联，而一个有m个块的完全关联的缓存可以被称为 "m-way集合关联"。等价地，直接映射可以被认为是有m个集合，而完全关联则是有一个集合。

今天绝大多数的处理器缓存都是直接映射的，双向集合关联的，或者四向集合关联的，原因我们很快就会看到。

